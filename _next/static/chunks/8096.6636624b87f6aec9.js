"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8096],{14158:function(e,t,a){a.d(t,{r:function(){return n}});var r=a(16196);let n={WalletClientNotFound:new r.AQ({code:9999,message:"WalletClient is undefined"}),EEthHelperNotFound:new r.AQ({code:9998,message:"eETH helper is undefined"}),CCDMRevert:new r.AQ({code:9997,message:"CCDM is not supported"}),BaseFeePerGasNull:new r.AQ({code:9996,message:"block baseFeePerGas is null"}),WagmiConfigNull:new r.AQ({code:9995,message:"WagmiConfig is null"}),UnknownRemoteDomain:new r.AQ({code:9994,message:"RemoteDomain is null"})}},19844:function(e,t,a){a.d(t,{C:function(){return d}});var r=a(95393),n=a(42337),s=a(16196);let{isNativeAsset:i}=(0,a(93282).Ng)(),d=e=>{let{address:t,chainInfo:a,asset:d}=e,o=a.providerConfig.id,{chainName:l}=(0,s.Ps)(o),{data:u,refetch:c}=(0,r.K)({chainId:o,address:t,query:{enabled:i(d)&&(0,s.yG)(t)&&!!o&&!!l,retry:0}}),{data:f,refetch:v}=(0,n.u)({chainId:o,abi:s.RB,functionName:"balanceOf",address:d.address,args:[(0,s.F5)(t)],query:{enabled:!i(d)&&(0,s.yG)(t)&&!!o&&!!l,retry:0}});return{data:i(d)?null==u?void 0:u.value:f,refetch:()=>{i(d)&&c(),i(d)||v()}}}},48096:function(e,t,a){a.r(t),a.d(t,{OrderProcessor:function(){return ea},default:function(){return er}});var r,n,s=a(52322),i=a(2784),d=a(44761),o=a(1491),l=a(42925),u=a(11027),c=a(76199),f=a(70018);async function v(e,t){let{chainId:a,timeout:r=0,...n}=t,s=e.getClient({chainId:a}),i=(0,f.s)(s,l.e,"waitForTransactionReceipt"),d=await i({...n,timeout:r});if("reverted"===d.status){let e=(0,f.s)(s,u.f,"getTransaction"),t=await e({hash:d.transactionHash}),a=(0,f.s)(s,c.RE,"call"),r=await a({...t,gasPrice:"eip1559"!==t.type?t.gasPrice:void 0,maxFeePerGas:"eip1559"===t.type?t.maxFeePerGas:void 0,maxPriorityFeePerGas:"eip1559"===t.type?t.maxPriorityFeePerGas:void 0});throw Error(r?.data?(0,o.rR)(`0x${r.data.substring(138)}`):"unknown reason")}return{...d,chainId:s.chain.id}}var p=a(35775),h=a(91436),m=a(75422),w=a(39929);function g(e={}){let{hash:t,query:a={}}=e,r=(0,w.Z)(e),n=(0,m.x)({config:r}),s=function(e,t={}){return{async queryFn({queryKey:a}){let{hash:r,...n}=a[1];if(!r)throw Error("hash is required");return v(e,{...n,onReplaced:t.onReplaced,hash:r})},queryKey:function(e={}){let{onReplaced:t,...a}=e;return["waitForTransactionReceipt",(0,p.O)(a)]}(t)}}(r,{...e,chainId:e.chainId??n}),i=!!(t&&(a.enabled??!0));return(0,h.aM)({...a,...s,enabled:i})}var C=a(87686),y=a(14010),F=a(16196),S=a(95629),I=a(83997),x=a(93282),T=a(26108),E=a(68077),N=a(53380),b=a(1),A=a(60783),P=a(65187),R=a(37561),D=a(29856),Y=a(14158),q=a(93156),B=a(48674);async function H(e,t={}){let{chainId:a,...r}=t,n=e.getClient({chainId:a}),s=(0,f.s)(n,B.Q,"getBlock");return{...await s(r),chainId:n.chain.id}}var Q=a(75096),O=a(42369),W=a(57727);async function G(e,t){let a;let{chainId:r,connector:n,...s}=t;a=t.account?t.account:(await (0,W.e)(e,{account:t.account,chainId:r,connector:n})).account;let i=e.getClient({chainId:r});return(0,f.s)(i,O.Q,"estimateGas")({...s,account:a})}let K=async e=>{let{walletClient:t,signature:a,callContext:r,orderAmount:n}=e,s=t.account.address,i=(0,F.F5)(s);return await t.writeContract({...r,functionName:"deposit",args:void 0===a?[n,i]:[n,i,a]})},z=async e=>{let{walletClient:t,signature:a,callContext:r,orderAmount:n,vault:s}=e;return await t.writeContract({...r,functionName:"deposit",args:void 0===a?[n,s]:[n,s,a]})},k=async(e,t)=>{var a;let{walletClient:r,signature:n,callContext:s,orderAmount:i,remoteChain:d}=t,o=r.account.address,l=F.$N[s.chainId],u=null==l?void 0:null===(a=l.ccdm)||void 0===a?void 0:a.host;if(void 0===u)throw Y.r.CCDMRevert;let c=(0,F.F5)(o),{baseFeePerGas:f}=await H(e,{chainId:s.chainId,blockTag:"latest"});if(null===f)throw Y.r.BaseFeePerGasNull;let v=await (0,Q.L)(e,{...s,functionName:"previewDepositTo",args:[d,u,c,c,i,f]}),p=BigInt(65e4),h=v*BigInt(2);try{p=await G(e,{to:s.address,data:(0,q.R)({abi:s.abi,functionName:"depositTo",args:void 0===n?[d,u,i,c,c]:[d,u,i,c,c,n]}),value:h})*BigInt(1.5)+BigInt(21e3)}catch(e){}return await r.writeContract({...s,functionName:"depositTo",args:void 0===n?[d,u,i,c,c]:[d,u,i,c,c,n],value:h,gas:p})},j=async(e,t)=>{var a;let{walletClient:r,signature:n,callContext:s,orderAmount:i,remoteChain:d}=t,o=r.account.address,l=F.$N[s.chainId],u=null==l?void 0:null===(a=l.ccdm)||void 0===a?void 0:a.host;if(void 0===u)throw Y.r.CCDMRevert;let c=(0,F.F5)(o),{baseFeePerGas:f}=await H(e,{chainId:s.chainId,blockTag:"latest"});if(null===f)throw Y.r.BaseFeePerGasNull;let v=await (0,Q.L)(e,{...s,functionName:"previewDepositWeEthTo",args:[d,u,c,c,i,f]}),p=BigInt(65e4),h=v*BigInt(2);try{p=await G(e,{to:s.address,data:(0,q.R)({abi:s.abi,functionName:"depositWeEthTo",args:void 0===n?[d,u,i,c,c]:[d,u,i,c,c,n]}),value:h})*BigInt(1.5)+BigInt(21e3)}catch(e){}return await r.writeContract({...s,functionName:"depositWeEthTo",args:void 0===n?[d,u,i,c,c]:[d,u,i,c,c,n],value:h,gas:p})},L=e=>({depositPAsset:e=>K(e),depositEETH:e=>z(e),depositEETHTo:t=>k(e,t),depositWEETHTo:t=>j(e,t)});F.M8,F.M8;let M=async(e,t)=>{let{walletClient:a,callContext:r,spender:n,orderAmount:s}=t;if(void 0===a&&void 0===a)throw new F.AQ({code:9999,message:"[Permit] WalletClient is undefined"});let i=a.account.address,d=F.RB,o={...r,abi:d},l=await a.getChainId();if(await (0,Q.L)(e,{...o,functionName:"allowance",args:[(0,F.F5)(i),n]})>=s)return{signature:void 0};let u=await a.writeContract({...o,functionName:"approve",args:[n,F.fV]});return await v(e,{hash:u,chainId:l}),await (0,F._v)(300),{signature:void 0}},U=e=>{let{onSuccess:t,onError:a}=null!=e?e:{},r=(0,D.Ok)(),n=async e=>{let{recipe:t,walletClient:a}=e,{callType:n,pAssetInfo:s,srcChainInfo:i,dstChainInfo:d,mAssetInfo:o}=t,{orderAmount:l}=e.order;if(null===r)throw Y.r.WagmiConfigNull;let{depositEETH:u,depositEETHTo:c,depositWEETHTo:f,depositPAsset:v}=L(r);switch(n){case R.rf.CrossChain:switch(s.symbol){case"eETH":case"weETH":{let e=F.$N[i.providerConfig.id].eEthDepositHelper;if(void 0===e)throw Y.r.EEthHelperNotFound;if("ethereum"===d.chainName||"ethereum"!==i.chainName)throw Y.r.CCDMRevert;let t=P.EO[d.chainName];if(void 0===t)throw Y.r.UnknownRemoteDomain;let n={chainId:i.providerConfig.id,address:s.address},{signature:o}=await M(r,{walletClient:a,callContext:n,symbol:s.symbol,spender:e,orderAmount:l}),u={walletClient:a,signature:o,callContext:{chainId:i.providerConfig.id,address:e,abi:F.vG},orderAmount:l,remoteChain:t,wagmiConfig:r};return"eETH"===s.symbol?await c(u):await f(u)}}case R.rf.SingleChain:if("eETH"===s.symbol){let e=F.$N[i.providerConfig.id].eEthDepositHelper;if(void 0===e)throw Y.r.EEthHelperNotFound;let t={chainId:i.providerConfig.id,address:s.address},{signature:n}=await M(r,{walletClient:a,callContext:t,symbol:s.symbol,spender:e,orderAmount:l}),d={chainId:i.providerConfig.id,address:e,abi:F.vG};return await u({callContext:d,signature:n,walletClient:a,orderAmount:l,vault:o.address})}{let e={chainId:i.providerConfig.id,address:s.address},{signature:t}=await M(r,{walletClient:a,callContext:e,symbol:s.symbol,spender:o.address,orderAmount:l}),n={chainId:i.providerConfig.id,address:o.address,abi:F.dt};return await v({callContext:n,signature:t,walletClient:a,orderAmount:l})}}},{mutate:s}=(0,C.D)({mutationFn:n,onSuccess(e){null==t||t(e)},onError(e){null==a||a(e)}});return{process:s}};var $=a(19844),_=a(67934);(r=n||(n={}))[r.Pending=0]="Pending",r[r.Prepare=1]="Prepare",r[r.Ready=2]="Ready",r[r.Processing=3]="Processing";let Z=e=>{let{walletClient:t,orderProcess:a,updateOrderProcess:r}=e,{order:s}=a,{recipe:d}=s,{srcChainInfo:o}=d,[l,u]=(0,i.useState)(n.Pending),{switchChain:c,currentChain:f}=(0,A.F)(),{mutate:v}=(0,C.D)({mutationFn:()=>c(o.providerConfig.id,o.chainName),onSuccess(){u(n.Ready)},onError(e){let t=F.AQ.wrap(e);r({status:N.Ym.SrcApproveFailed,error:t})}});(0,i.useEffect)(()=>{u(n.Prepare)},[]);let{process:p}=U({onSuccess(e){r({status:N.Ym.SrcApproveSuccess,result:{srcTxHash:e}})},onError(e){let t=F.AQ.wrap(e);console.log(e),r({status:N.Ym.SrcApproveFailed,error:t})}});return(0,i.useEffect)(()=>{if(l===n.Prepare){v();return}if(l===n.Ready&&(null==f?void 0:f.id)===o.providerConfig.id){p({walletClient:t,order:s,recipe:d});return}},[l,null==f?void 0:f.id]),null},V=e=>{let{orderProcess:t,walletClient:a,updateOrderProcess:r}=e,{result:n,order:s}=t,o=null==n?void 0:n.srcTxHash,{recipe:l,orderAmount:u}=s,{callType:c,pAssetInfo:f,mAssetInfo:v,srcChainInfo:p,dstChainInfo:h}=l,{data:m,error:w}=g({chainId:p.providerConfig.id,hash:o,query:{enabled:null==o?void 0:o.startsWith("0x")}}),{refetch:C}=(0,$.C)({address:a.account.address,chainInfo:p,asset:f}),{refetch:x}=(0,$.C)({address:a.account.address,chainInfo:h,asset:v}),E=(0,y.NL)(),{modalConfig:b}=(0,T.L)(),{data:A}=S.wW.useGetAllEpoch(),{refetch:P}=S.wW.useGetUserStatus({address:a.account.address}),[R,D]=(0,i.useState)(!1),Y={onSrcChainTxBroadcasted(e){var t,a,n;let s=null==m?void 0:null===(t=m.logs.map(e=>{try{return(0,d.F)({abi:F.dt,data:e.data,topics:e.topics})}catch(e){return}}).find(e=>(null==e?void 0:e.eventName)==="Deposit"))||void 0===t?void 0:t.args;r({status:e,...e===N.Ym.DstSuccess?{result:{amount:u,successAmount:null!==(a=null==s?void 0:s.amount)&&void 0!==a?a:u,finalizedPAssetInfo:null!==(n=Object.values(p.assets).find(e=>e.address.toLowerCase()===(null==s?void 0:s.baseAsset.toLowerCase())))&&void 0!==n?n:f}}:{}}),C(),e===N.Ym.DstSuccess&&(b.isOpen||(0,I.Yz)(_.F.TxSuccess),E.invalidateQueries({queryKey:S.zI.getAllEpoch.queryKey()}),x(),P()),l.callType===N.rf.CrossChain&&D(!0)},onCCDTxSuccess(){b.isOpen||(0,I.Yz)(_.F.TxSuccess),E.invalidateQueries({queryKey:S.zI.getAllEpoch.queryKey()}),E.invalidateQueries({queryKey:S.zI.getUserStatus.queryKey({address:a.account.address})}),x(),P(),D(!1)},onTxFailed(e){r({status:e}),b.isOpen||(0,I.Yz)(_.F.TxFailed),D(!1)},onTxRefunded(){C(),x(),P(),E.invalidateQueries({queryKey:S.zI.getUserStatus.queryKey({address:a.account.address})}),(0,I.Yz)(_.F.Refunded(null==A?void 0:A.currentEpoch)),D(!1)},onTxRefundFailed(){(0,I.Yz)(_.F.TxFailed),D(!1)}};(0,i.useEffect)(()=>{if(w){Y.onTxFailed(N.Ym.SrcFailed);return}if(void 0===m)return;let e=(null==m?void 0:m.status)==="success";Y.onSrcChainTxBroadcasted((()=>{switch(c){case N.rf.SingleChain:if(e)return N.Ym.DstSuccess;return N.Ym.DstFailed;case N.rf.CrossChain:if(e)return N.Ym.SrcSuccess;return N.Ym.SrcFailed;default:return N.Ym.SrcFailed}})())},[m,w]);let{data:q}=S.wW.useInterchainTransactionDetail({domain:p.providerConfig.id,txHash:null!=o?o:""},{enabled:R,refetchInterval:!!R&&5e3});return(0,i.useEffect)(()=>{if(void 0!==q){var e;let t=S.QS[q.event.status],a=t===N.Ym.DstSuccess,n=t===N.Ym.SrcRefundSuccess,s=t===N.Ym.SrcRefundFailed;if(Object.values(N.Ym).includes(t)&&r({status:t,result:{srcTxHash:q.event.txHash,dstTxHash:null===(e=q.txs.find(e=>e.domain===h.providerConfig.id))||void 0===e?void 0:e.txHash,finalizedPAssetInfo:Object.values(p.assets).find(e=>e.address.toLowerCase()===q.event.tokenAddress.toLowerCase()),refundAmount:null===q.event.refundAmount?void 0:BigInt(q.event.refundAmount),successAmount:null===q.event.successAmount?void 0:BigInt(q.event.successAmount),amount:null===q.event.amount?void 0:BigInt(q.event.amount)}}),a){Y.onCCDTxSuccess();return}if(n){Y.onTxRefunded();return}if(s){Y.onTxRefundFailed();return}}},[q]),null},J=()=>{let{process:e,updateOrderProcess:t}=(0,E.B)(N.mr.Deposit),{account:a}=(0,b.aF)();return(0,s.jsx)(i.Fragment,{children:e.map(e=>void 0===(null==a?void 0:a.address)?null:e.status===N.Ym.SrcApprovePending&&(0,x.mr)(a)&&(null==a?void 0:a.walletClient)!==void 0?(0,s.jsx)(Z,{orderProcess:e,walletClient:a.walletClient,updateOrderProcess:a=>t({id:e.id,process:a})},e.id):e.status!==N.Ym.SrcApproveFailed&&e.status>=N.Ym.SrcApproveSuccess&&(0,x.mr)(a)&&(null==a?void 0:a.walletClient)!==void 0?(0,s.jsx)(V,{orderProcess:e,walletClient:a.walletClient,updateOrderProcess:a=>t({id:e.id,process:a})},e.id):void 0)})},X=e=>{let{walletClient:t,orderProcess:a,updateOrderProcess:r}=e,{order:s}=a,{orderAmount:d,recipe:o}=s,{mAssetInfo:l,srcChainInfo:u}=o,[c,f]=(0,i.useState)(n.Pending),{switchChain:v,currentChain:p}=(0,A.F)(),h=async()=>{if(void 0===t)throw new F.AQ({code:9999,message:"[Deposit] : WalletClient is undefined"});let e={chainId:u.providerConfig.id,address:l.address,abi:F.dt},a=(0,F.F5)(t.account.address);return await t.writeContract({...e,functionName:"redeem",args:[d,a]})},{mutate:m}=(0,C.D)({mutationFn:()=>v(u.providerConfig.id,u.chainName),onSuccess(){f(n.Ready)},onError(e){let t=F.AQ.wrap(e);r({status:N.NI.SrcApproveFailed,error:t})}}),{mutate:w}=(0,C.D)({mutationFn:h,onSuccess(e){r({status:N.NI.SrcApproveSuccess,result:{srcTxHash:e}})},onError(e){let t=F.AQ.wrap(e);console.log(e),r({status:N.NI.SrcApproveFailed,error:t})}});return(0,i.useEffect)(()=>{f(n.Prepare)},[]),(0,i.useEffect)(()=>{if(c===n.Prepare){m();return}if(c===n.Ready&&(null==p?void 0:p.id)===u.providerConfig.id){w();return}},[c,null==p?void 0:p.id]),null},ee=e=>{let{walletClient:t,orderProcess:a,updateOrderProcess:r}=e,{result:n,order:s}=a,d=null==n?void 0:n.srcTxHash,{recipe:o}=s,{pAssetInfo:l,mAssetInfo:u,srcChainInfo:c}=o,{data:f,error:v}=g({chainId:c.providerConfig.id,hash:d,query:{enabled:null==d?void 0:d.startsWith("0x")}}),{refetch:p}=(0,$.C)({address:t.account.address,chainInfo:c,asset:l}),{refetch:h}=(0,$.C)({address:t.account.address,chainInfo:c,asset:u}),m=(0,y.NL)(),{modalConfig:w}=(0,T.L)(),{refetch:C}=S.wW.useGetUserStatus({address:t.account.address}),F={onTxBroadcasted(e){e===N.NI.SrcSuccess&&(m.invalidateQueries({queryKey:S.zI.getAllEpoch.queryKey()}),w.isOpen||(0,I.Yz)(_.F.TxSuccess),p(),h(),C(),m.invalidateQueries({queryKey:S.zI.getUserStatus.queryKey({address:t.account.address})})),r({status:e})},onTxFailed(){r({status:N.NI.SrcFailed}),w.isOpen||(0,I.Yz)(_.F.TxFailed)}};return(0,i.useEffect)(()=>{if(v){F.onTxFailed();return}if(void 0===f)return;let e=(null==f?void 0:f.status)==="success";F.onTxBroadcasted(e?N.NI.SrcSuccess:N.NI.SrcFailed)},[f,v]),null},et=()=>{let{process:e,updateOrderProcess:t}=(0,E.B)(N.mr.Redeem),{account:a}=(0,b.aF)();return(0,s.jsx)(i.Fragment,{children:e.map(e=>void 0===(null==a?void 0:a.address)?null:e.status===N.NI.SrcApprovePending&&(0,x.mr)(a)&&(null==a?void 0:a.walletClient)!==void 0?(0,s.jsx)(X,{orderProcess:e,walletClient:a.walletClient,updateOrderProcess:a=>t({id:e.id,process:a})},e.id):e.status!==N.NI.SrcApproveFailed&&e.status>=N.NI.SrcApproveSuccess&&(0,x.mr)(a)&&(null==a?void 0:a.walletClient)!==void 0?(0,s.jsx)(ee,{orderProcess:e,walletClient:a.walletClient,updateOrderProcess:a=>t({id:e.id,process:a})},e.id):void 0)})},ea=()=>(0,s.jsxs)(i.Fragment,{children:[(0,s.jsx)(J,{}),(0,s.jsx)(et,{})]});var er=ea},42337:function(e,t,a){a.d(t,{u:function(){return o}});var r=a(75096),n=a(35775),s=a(91436),i=a(75422),d=a(39929);function o(e={}){let{abi:t,address:a,functionName:o,query:l={}}=e,u=(0,d.Z)(e),c=(0,i.x)({config:u}),f=function(e,t={}){return{async queryFn({queryKey:a}){let n=t.abi;if(!n)throw Error("abi is required");let{address:s,functionName:i,scopeKey:d,...o}=a[1];if(!s)throw Error("address is required");if(!i)throw Error("functionName is required");let l=o.args;return(0,r.L)(e,{abi:n,address:s,functionName:i,args:l,...o})},queryKey:function(e={}){let{abi:t,...a}=e;return["readContract",(0,n.O)(a)]}(t)}}(u,{...e,chainId:e.chainId??c}),v=!!(a&&t&&o&&(l.enabled??!0));return(0,s.aM)({...l,...f,enabled:v,structuralSharing:l.structuralSharing??s.if})}}}]);